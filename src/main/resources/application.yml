spring:
  application:
    name: daylogue

  main:
    allow-bean-definition-overriding: true

  output:
    ansi:
      enabled: always

  # 수정사항 생길시 자동 재빌드를 위한 코드
  devtools:
    livereload: 
      enabled: true
    restart:
      enabled: true
      additional-paths: 
        - src/main/java
        - src/main/resources
      exclude: static/**, public/** 


  # 기본 연결 DB 설정
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/timeflow?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661
  # auth DB 연결 설정
  auth-datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/auth_db?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661
  # diary DB 연결 설정
  diary-datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/diary_db?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661
  # memo DB 연결 설정
  memo-datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/memo_db?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661
  # planner DB 연결 설정
  planner-datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/planner_db?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661
  # routine DB 연결 설정
  routine-datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/routine_db?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661
  # settings DB 연결 설정
  settings-datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/settings_db?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661
  # share DB 연결 설정
  share-datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/share_db?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661
  # task DB 연결 설정
  task-datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3307/task_db?sslMode=DISABLED&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul
    username: timeflow
    password: timeflow9661

# mail
#spring.mail.port=587
#spring.mail.properties.mail.smtp.auth=true
#spring.mail.properties.mail.smtp.starttls.enable=true
#spring.mail.transport.protocol=smtp
#spring.mail.debug=true
#spring.mail.default.encoding=UTF-8
#spring.mail.mime.charset=UTF-8
#spring.mail.username=본인 이메일 주소
#spring.mail.password=본인 이메일 비밀번호
  mail:
    host: smtp.gmail.com
    port: 587
    username: 이메일
    password: 아까 저장해둔 앱 비밀번호 복붙
    properties:
      mail:
        debug: true
        smtp:
          auth: true
          starttls:
            enable: true
            required: true
          connection-timeout: 5000
          timeout: 5000
          write-timeout: 5000


  # 이메일 발송시 사용하는 html 템플릿 설정
  ## thymeleaf default settings
  #  spring.thymeleaf.prefix=/WEB-INF/views/pages/
  #  spring.thymeleaf.suffix=.html
  #  spring.thymeleaf.mode=HTML
  #  spring.thymeleaf.encoding=UTF-8
  #  spring.thymeleaf.cache=false

  jpa:
    show-sql: true
    generate-ddl: false
    database-platform: org.hibernate.dialect.MySQLDialect
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        format_sql: true

  # 어떤 프로파일을 기본으로 사용할지(로컬 개발 기본값)
  # - 운영에서는 보통 환경변수/실행 옵션으로 덮어씀:
  #   예) -Dspring.profiles.active=prod
  profiles:
    active: local

  jackson:
    # 날짜/시간을 타임스탬프(숫자) 대신 ISO 8601 문자열로 직렬화 권장
    serialization:
      write-dates-as-timestamps: false

    # 응답 JSON의 기본 타임존을 UTC로 맞추는 용도(권장)
    # - 서버 저장 UTC 정책과 맞춤
    time-zone: UTC

  mvc:
    # Spring 3.x에서 Problem Details(RFC7807) 응답을 활성화할 수 있음
    # - 다만 너는 공통 응답 래퍼(ApiResponse)를 쓸 계획이므로,
    #   최종적으로는 GlobalExceptionHandler에서 통일하는 쪽이 더 깔끔함
    problemdetails:
      enabled: true

# FILE: src/main/resources/application.yml
# -----------------------------------------------------------------------------
# 공통(모든 환경) 기본 설정
# - 환경별(local/dev/prod)로 달라지는 값은 application-*.yml에서 오버라이드
# - Spring Boot는 기본적으로 "application.yml" + "application-{profile}.yml"을 합쳐서 로드함
# -----------------------------------------------------------------------------

server:
  port: 8080
  # 서버가 정상 종료(graceful shutdown)되도록 함(요청 처리 중이면 잠시 대기 후 종료)
  shutdown: graceful

  # 리버스 프록시(nginx/ALB) 뒤에서 X-Forwarded-* 헤더를 처리할 때 유용
  # - Spring Boot 2.6+ / 3.x에서 주로 사용
  # - 만약 Boot 2.5 이하라면 이 옵션이 동작이 다를 수 있음(그땐 server.use-forward-headers=true 고려)
  forward-headers-strategy: framework

  servlet:
    context-path: /
    encoding:
      charset: UTF-8
      enabled: true
      force: true
    session:
      timeout: 30m  # 30분 후 세션 만료 (10m, 60s 등 설정 가능) [1, 6]
logging:
  # default Logging 프레임워크 설정 파일을 참조
  config: classpath:log4j2.xml
  level:
    root: INFO
    # 웹 요청 로그(필요시 DEBUG로 올림)
    org.springframework.web: INFO
    # Security 디버깅할 때 DEBUG로 올림(운영에서는 INFO 권장)
    org.springframework.security: INFO

management:
  endpoints:
    web:
      # actuator 노출 엔드포인트 지정
      exposure:
        include: health,info
  endpoint:
    health:
      # health 상세정보 노출 범위(운영은 when_authorized 권장)
      show-details: never

# -----------------------------------------------------------------------------
# 커스텀 앱 설정(prefix를 app로 통일)
# -----------------------------------------------------------------------------
app:
  api:
    # 프론트/백 통신에서 /api 베이스를 강제하고 싶을 때 사용(컨트롤러/필터/리버스프록시에서 활용)
    base-path: /api

  cors:
    # 프론트 개발 서버(React) 기본 허용
    # - 여러 도메인을 허용하려면 배열로 추가
    allowed-origins:
      - http://localhost:3000
    # 허용 메서드
    allowed-methods: [GET, POST, PUT, PATCH, DELETE, OPTIONS]
    # 허용 헤더(개발 단계에서는 * 허용이 편함)
    allowed-headers: ["*"]
    # 쿠키/인증정보 포함 요청 허용 여부
    allow-credentials: true

  security:
    jwt:
      # 토큰 발급자(issuer). 검증 시 일치 체크에 활용 가능
      issuer: timeflow
      # accessToken 만료(초) - 예: 1시간
      access-token-ttl-seconds: 360000
      # refreshToken 만료(초) - 예: 14일
      refresh-token-ttl-seconds: 1209600
      # 운영에서는 반드시 환경변수로 주입 권장
      # - 예) JWT_SECRET=매우긴랜덤문자열
      secret: "CHANGE_ME_TO_A_LONG_RANDOM_SECRET_32BYTES_MINIMUM"
      access-ttl-seconds: 900
      refresh-ttl-seconds: 1209600
    cors:
      allowed-origins: "http://localhost:3000"

springdoc:
  packages-to-scan: com.timepalette.daylogue
#  version: V.0.0.1  # 버전 기록용
  # Swagger UI 기본 경로
  cache:
    disabled: true              # OpenAPI 문서의 캐싱 비활성화 (기본값: false)
  swagger-ui:
    enabled: true       # Swagger UI 사용여부 : 접근 경로 => <http://localhost:8080/swagger-ui/index.html>
    path: /demo-ui.html   # String, Swagger-ui HTML 문서의 사용자 정의 경로
    tags-sorter: alpha  # API 태그 목록에 정렬을 적용(alpha -> 영숫자순으로 경로별로 정렬)
    operations-sorter: alpha  # API 작업 목록에 정렬을 적용(alpha -> 영숫자 경로 기준 정렬)
    display-request-duration: true  # 요청 실행 시간 표시 여부
    doc-expansion: none  # Swagger UI에서 API 설명의 기본 펼침 상태 (none: 닫힘, list: 펼침, full: 전체 펼침)
    persistAuthorization: true  # 페이지 새로고침 후에도 Authorization 헤더 유지 여부
    defaultModelsExpandDepth: -1  # 모델 스키마의 기본 펼침 깊이 (-1이면 모델 펼쳐지지 않음)
  api-docs:
    enabled: true  # API 문서(`/v3/api-docs`) 활성화 여부 (기본값: true)
    path: /v3/api-docs  # API 작업 목록에 정렬을 적용(alpha -> 영숫자 경로 기준 정렬)
    groups:
      enabled: true
  # 기본값 : 미디어 유형
  default-consumes-media-type: application/json;charset=UTF-8
  default-produces-media-type: application/json;charset=UTF-8
  show-actuator: false  # Spring Actuator 엔드포인트를 Swagger UI에 표시할지 여부 (기본값: false)
